{"kind":"article","sections":[],"abstract":[{"text":"Understand how TUIkit turns your view tree into terminal output: one frame at a time.","type":"text"}],"hierarchy":{"paths":[["doc:\/\/TUIkit\/documentation\/TUIkit"]]},"identifier":{"url":"doc:\/\/TUIkit\/documentation\/TUIkit\/RenderCycle","interfaceLanguage":"swift"},"seeAlsoSections":[{"title":"Essentials","identifiers":["doc:\/\/TUIkit\/documentation\/TUIkit\/GettingStarted","doc:\/\/TUIkit\/documentation\/TUIkit\/Architecture","doc:\/\/TUIkit\/documentation\/TUIkit\/AppLifecycle"],"generated":true,"anchor":"Essentials"}],"metadata":{"roleHeading":"Article","title":"Render Cycle","role":"article","modules":[{"name":"TUIkit"}]},"primaryContentSections":[{"kind":"content","content":[{"text":"Overview","type":"heading","level":2,"anchor":"Overview"},{"inlineContent":[{"type":"text","text":"Every frame in TUIkit follows the same synchronous pipeline: "},{"type":"strong","inlineContent":[{"type":"text","text":"clear per-frame state → build environment → render the view tree → diff against previous frame → flush to terminal → track lifecycle"}]},{"type":"text","text":". The view tree is fully re-evaluated each frame, but only "},{"type":"strong","inlineContent":[{"type":"text","text":"changed terminal lines"}]},{"type":"text","text":" are written: and all writes are collected in a frame buffer and flushed as a "},{"type":"strong","inlineContent":[{"text":"single ","type":"text"},{"code":"write()","type":"codeVoice"},{"text":" syscall","type":"text"}]},{"type":"text","text":"."}],"type":"paragraph"},{"text":"What Triggers a Frame","type":"heading","level":2,"anchor":"What-Triggers-a-Frame"},{"inlineContent":[{"type":"text","text":"Several sources cause "},{"type":"codeVoice","code":"RenderLoop"},{"type":"text","text":" to produce a new frame. They converge on two boolean checks in the main loop ("},{"type":"codeVoice","code":"consumeRerenderFlag()"},{"type":"text","text":" and "},{"type":"codeVoice","code":"appState.needsRender"},{"type":"text","text":"):"}],"type":"paragraph"},{"type":"table","header":"row","rows":[[[{"type":"paragraph","inlineContent":[{"text":"Trigger","type":"text"}]}],[{"inlineContent":[{"text":"Source","type":"text"}],"type":"paragraph"}],[{"inlineContent":[{"text":"Mechanism","type":"text"}],"type":"paragraph"}]],[[{"inlineContent":[{"text":"Terminal resize","type":"text"}],"type":"paragraph"}],[{"inlineContent":[{"type":"codeVoice","code":"SIGWINCH"},{"type":"text","text":" signal"}],"type":"paragraph"}],[{"inlineContent":[{"code":"SignalManager","type":"codeVoice"},{"text":" sets ","type":"text"},{"code":"signalNeedsRerender","type":"codeVoice"},{"text":" and ","type":"text"},{"code":"signalTerminalResized","type":"codeVoice"}],"type":"paragraph"}]],[[{"inlineContent":[{"type":"text","text":"State mutation"}],"type":"paragraph"}],[{"inlineContent":[{"type":"codeVoice","code":"@State"},{"type":"text","text":" property change"}],"type":"paragraph"}],[{"inlineContent":[{"type":"codeVoice","code":"AppState"},{"type":"text","text":" observer calls "},{"type":"codeVoice","code":"signals.requestRerender()"}],"type":"paragraph"}]],[[{"inlineContent":[{"text":"Animation timers","type":"text"}],"type":"paragraph"}],[{"inlineContent":[{"type":"text","text":"PulseTimer (100 ms) \/ CursorTimer (50 ms)"}],"type":"paragraph"}],[{"inlineContent":[{"type":"text","text":"Calls "},{"code":"appState.setNeedsRender()","type":"codeVoice"}],"type":"paragraph"}]],[[{"inlineContent":[{"text":"Focus change","type":"text"}],"type":"paragraph"}],[{"inlineContent":[{"type":"codeVoice","code":"FocusManager.onFocusChange"}],"type":"paragraph"}],[{"inlineContent":[{"type":"text","text":"Resets pulse timer and calls "},{"code":"appState.setNeedsRender()","type":"codeVoice"}],"type":"paragraph"}]]]},{"inlineContent":[{"text":"All triggers converge on boolean flags that the main loop checks each iteration. The actual rendering always happens on the main thread: signal handlers never render directly.","type":"text"}],"type":"paragraph"},{"text":"The Render Pipeline","type":"heading","level":2,"anchor":"The-Render-Pipeline"},{"inlineContent":[{"type":"text","text":"Each call to "},{"code":"RenderLoop.render()","type":"codeVoice"},{"type":"text","text":" executes these steps in order:"}],"type":"paragraph"},{"inlineContent":[{"identifier":"render-cycle-pipeline.png","type":"image"}],"type":"paragraph"},{"text":"Step 1: Clear Per-Frame State","type":"heading","level":3,"anchor":"Step-1-Clear-Per-Frame-State"},{"inlineContent":[{"type":"text","text":"Five subsystems are reset at the start of every frame:"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"inlineContent":[{"code":"KeyEventDispatcher","type":"codeVoice"}],"type":"strong"},{"text":": All key handlers are removed. Views re-register them during rendering via ","type":"text"},{"type":"codeVoice","code":"onKeyPress()"},{"text":" modifiers.","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"inlineContent":[{"type":"codeVoice","code":"PreferenceStorage"}],"type":"strong"},{"text":": All preference callbacks are cleared and the stack is reset to a single empty ","type":"text"},{"code":"PreferenceValues","type":"codeVoice"},{"text":".","type":"text"}]}]},{"content":[{"inlineContent":[{"inlineContent":[{"type":"codeVoice","code":"FocusManager"}],"type":"strong"},{"type":"text","text":": All focus registrations are cleared. Focusable views re-register during rendering."}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"strong","inlineContent":[{"type":"codeVoice","code":"StatusBarState"}]},{"type":"text","text":": Section items are cleared. Views re-register them via "},{"code":".statusBarItems()","type":"codeVoice"},{"type":"text","text":" modifiers."}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"inlineContent":[{"type":"codeVoice","code":"AppHeaderState"}],"type":"strong"},{"text":": Header content is cleared. The ","type":"text"},{"code":".appHeader()","type":"codeVoice"},{"text":" modifier repopulates it during rendering.","type":"text"}]}]}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Additionally, the "},{"type":"codeVoice","code":"StatusBarState"},{"type":"text","text":" receives a reference to the current "},{"type":"codeVoice","code":"FocusManager"},{"type":"text","text":" for section resolution."}]},{"type":"paragraph","inlineContent":[{"text":"This ensures that views which disappeared between frames don’t leave stale handlers or registrations behind.","type":"text"}]},{"anchor":"Step-2-Begin-Lifecycle-and-State-Tracking","type":"heading","text":"Step 2: Begin Lifecycle and State Tracking","level":3},{"type":"paragraph","inlineContent":[{"text":"The ","type":"text"},{"code":"LifecycleManager","type":"codeVoice"},{"text":" prepares for a new frame by clearing its ","type":"text"},{"code":"currentRenderTokens","type":"codeVoice"},{"text":" set. The ","type":"text"},{"code":"StateStorage","type":"codeVoice"},{"text":" clears its active identity set. The ","type":"text"},{"code":"RenderCache","type":"codeVoice"},{"text":" begins a new render pass for cache hit\/miss tracking. As views render, they add their tokens\/identities to these sets. After rendering, the managers compare current and previous frames to detect which views appeared, disappeared, or had their state removed.","type":"text"}]},{"anchor":"Step-3-Build-Environment","type":"heading","text":"Step 3: Build Environment","level":3},{"type":"paragraph","inlineContent":[{"text":"A fresh ","type":"text"},{"code":"EnvironmentValues","type":"codeVoice"},{"text":" instance is assembled from the current subsystem state:","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["\/\/ Simplified from RenderLoop.buildEnvironment()","var env = EnvironmentValues()","env.statusBar           = statusBar","env.appHeader           = appHeader","env.focusManager        = focusManager","env.paletteManager      = paletteManager","env.palette             = paletteManager.currentPalette","env.appearanceManager   = appearanceManager","env.appearance          = appearanceManager.currentAppearance","env.notificationService = NotificationService.current","env.stateStorage        = tuiContext.stateStorage","env.lifecycle           = tuiContext.lifecycle","env.keyEventDispatcher  = tuiContext.keyEventDispatcher","env.renderCache         = tuiContext.renderCache","env.preferenceStorage   = tuiContext.preferences","env.localizationService = LocalizationService.shared"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"This environment is immutable for the duration of the frame. Runtime services (state storage, lifecycle, key dispatch, render cache, preferences) are injected here so that views and modifiers can access them through the environment rather than through "},{"type":"codeVoice","code":"TUIContext"},{"type":"text","text":" directly."}]},{"anchor":"Step-4-Create-Render-Context","type":"heading","text":"Step 4: Create Render Context","level":3},{"type":"paragraph","inlineContent":[{"type":"text","text":"A "},{"type":"codeVoice","code":"RenderContext"},{"type":"text","text":" bundles everything a view needs to render:"}]},{"type":"table","rows":[[[{"type":"paragraph","inlineContent":[{"type":"text","text":"Property"}]}],[{"type":"paragraph","inlineContent":[{"text":"What","type":"text"}]}]],[[{"type":"paragraph","inlineContent":[{"code":"availableWidth","type":"codeVoice"}]}],[{"type":"paragraph","inlineContent":[{"text":"Terminal width (mutable: containers reduce this for children)","type":"text"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"availableHeight"}]}],[{"type":"paragraph","inlineContent":[{"text":"Terminal height minus status bar (mutable)","type":"text"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"environment"}]}],[{"type":"paragraph","inlineContent":[{"text":"The ","type":"text"},{"code":"EnvironmentValues","type":"codeVoice"},{"text":" from step 3","type":"text"}]}]],[[{"type":"paragraph","inlineContent":[{"code":"tuiContext","type":"codeVoice"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"The "},{"type":"codeVoice","code":"TUIContext"},{"type":"text","text":" (lifecycle, key dispatch, preferences, state storage)"}]}]],[[{"type":"paragraph","inlineContent":[{"code":"identity","type":"codeVoice"}]}],[{"type":"paragraph","inlineContent":[{"text":"The current view’s structural identity (","type":"text"},{"code":"ViewIdentity","type":"codeVoice"},{"text":")","type":"text"}]}]]],"header":"row"},{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"RenderContext"},{"type":"text","text":" is a pure data container: it does not hold a reference to "},{"type":"codeVoice","code":"Terminal"},{"type":"text","text":". All terminal I\/O happens after the view tree has been rendered into a "},{"type":"codeVoice","code":"FrameBuffer"},{"type":"text","text":"."}]},{"type":"paragraph","inlineContent":[{"text":"The context is passed down the view tree. Each view can create a modified copy for its children: for example, a border reduces ","type":"text"},{"type":"codeVoice","code":"availableWidth"},{"text":" by 2 before rendering its content. Container views extend the ","type":"text"},{"type":"codeVoice","code":"identity"},{"text":" path for each child.","type":"text"}]},{"type":"heading","text":"Step 5: Evaluate Scene","anchor":"Step-5-Evaluate-Scene","level":3},{"type":"paragraph","inlineContent":[{"code":"app.body","type":"codeVoice"},{"text":" is evaluated fresh each frame, producing a ","type":"text"},{"isActive":true,"identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/WindowGroup","type":"reference"},{"text":" that wraps the root view. The ","type":"text"},{"code":"WindowGroup","type":"codeVoice"},{"text":" implements ","type":"text"},{"code":"SceneRenderable","type":"codeVoice"},{"text":" and bridges from the scene layer to the view layer.","type":"text"}]},{"type":"aside","style":"note","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Views are fully reconstructed on every frame. "},{"code":"@State","type":"codeVoice"},{"type":"text","text":" values survive because "},{"code":"State.init","type":"codeVoice"},{"type":"text","text":" self-hydrates from "},{"code":"StateStorage","type":"codeVoice"},{"type":"text","text":": looking up the persistent value by the view’s structural identity."}]}],"name":"Note"},{"type":"heading","text":"Step 6: Render View Tree","anchor":"Step-6-Render-View-Tree","level":3},{"type":"paragraph","inlineContent":[{"type":"text","text":"This is where the dual rendering system kicks in. "},{"type":"reference","isActive":true,"identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/WindowGroup"},{"type":"text","text":" calls the free function "},{"code":"renderToBuffer()","type":"codeVoice"},{"type":"text","text":" on its content, which recursively traverses the entire view tree and produces a "},{"code":"FrameBuffer","type":"codeVoice"},{"type":"text","text":"."}]},{"type":"aside","style":"note","content":[{"inlineContent":[{"text":"See ","type":"text"},{"identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/RenderCycle#The-Dual-Rendering-System","isActive":true,"type":"reference"},{"text":" below for details on how views are dispatched.","type":"text"}],"type":"paragraph"}],"name":"Note"},{"type":"heading","text":"Step 7: Build Output Lines","anchor":"Step-7-Build-Output-Lines","level":3},{"type":"paragraph","inlineContent":[{"text":"The ","type":"text"},{"code":"FrameBuffer","type":"codeVoice"},{"text":" is converted into terminal-ready output lines by ","type":"text"},{"code":"FrameDiffWriter.buildOutputLines()","type":"codeVoice"},{"text":":","type":"text"}]},{"type":"orderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Lines with content get their ANSI reset codes replaced with ","type":"text"},{"code":"reset + backgroundColor","type":"codeVoice"},{"text":" (persistent background)","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Each line is padded to full terminal width"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Empty rows are filled with the background color"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"The total output is exactly ","type":"text"},{"code":"terminalHeight","type":"codeVoice"},{"text":" lines","type":"text"}]}]}]},{"type":"heading","text":"Step 8: Begin Buffered Frame","anchor":"Step-8-Begin-Buffered-Frame","level":3},{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"Terminal.beginFrame()"},{"text":" activates output buffering. From this point, all ","type":"text"},{"type":"codeVoice","code":"Terminal.write()"},{"text":" calls append to an internal ","type":"text"},{"type":"codeVoice","code":"[UInt8]"},{"text":" buffer instead of issuing syscalls.","type":"text"}]},{"type":"heading","text":"Step 9: Render App Header and Diff Content","anchor":"Step-9-Render-App-Header-and-Diff-Content","level":3},{"type":"paragraph","inlineContent":[{"text":"If the app header has content (set by the ","type":"text"},{"code":".appHeader()","type":"codeVoice"},{"text":" modifier), it is rendered at the top of the terminal. Then ","type":"text"},{"code":"FrameDiffWriter.writeContentDiff()","type":"codeVoice"},{"text":" compares the main content output lines with the previous frame and writes ","type":"text"},{"inlineContent":[{"text":"only changed lines","type":"text"}],"type":"strong"},{"text":" to the terminal buffer. For mostly-static UIs, this reduces writes by ~94%.","type":"text"}]},{"type":"heading","text":"Step 10: Render Status Bar","anchor":"Step-10-Render-Status-Bar","level":3},{"type":"paragraph","inlineContent":[{"type":"text","text":"The status bar renders in a separate pass but writes into the "},{"inlineContent":[{"text":"same frame buffer","type":"text"}],"type":"strong"},{"type":"text","text":", so app header, content, and status bar are flushed together."}]},{"type":"heading","text":"Step 11: Flush Frame","anchor":"Step-11-Flush-Frame","level":3},{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"Terminal.endFrame()"},{"text":" writes the entire collected buffer to ","type":"text"},{"type":"codeVoice","code":"STDOUT_FILENO"},{"text":" in a ","type":"text"},{"inlineContent":[{"type":"text","text":"single "},{"code":"write()","type":"codeVoice"},{"type":"text","text":" syscall"}],"type":"strong"},{"text":", then resets the buffer. This reduces per-frame syscalls from ~40+ to exactly 1.","type":"text"}]},{"type":"heading","text":"Step 12: End Lifecycle and State Tracking","anchor":"Step-12-End-Lifecycle-and-State-Tracking","level":3},{"type":"paragraph","inlineContent":[{"type":"text","text":"Three managers finalize the frame:"}]},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"The ","type":"text"},{"inlineContent":[{"type":"codeVoice","code":"LifecycleManager"}],"type":"strong"},{"text":" compares the current frame’s tokens with the previous frame’s. Disappeared views (tokens present last frame but absent now) fire their ","type":"text"},{"code":"onDisappear","type":"codeVoice"},{"text":" callbacks; their tokens are removed from the appeared set, allowing future ","type":"text"},{"code":"onAppear","type":"codeVoice"},{"text":" if they return.","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"The "},{"inlineContent":[{"type":"codeVoice","code":"StateStorage"}],"type":"strong"},{"type":"text","text":" performs garbage collection: any state whose view identity was not marked active during this render pass is removed. This prevents memory leaks from views that have been permanently removed."}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"The "},{"inlineContent":[{"type":"codeVoice","code":"RenderCache"}],"type":"strong"},{"type":"text","text":" removes inactive entries (subtrees no longer in the view tree) and optionally logs per-frame cache statistics."}],"type":"paragraph"}]}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"All state changes inside the lifecycle manager are "},{"type":"codeVoice","code":"NSLock"},{"type":"text","text":"-protected. Callbacks execute "},{"type":"strong","inlineContent":[{"type":"text","text":"outside"}]},{"type":"text","text":" the lock to prevent deadlocks."}]},{"type":"heading","text":"Status Bar Rendering (Step 10)","anchor":"Status-Bar-Rendering-Step-10","level":3},{"type":"paragraph","inlineContent":[{"type":"text","text":"The status bar renders in a separate pass but within the same buffered frame:"}]},{"type":"orderedList","items":[{"content":[{"inlineContent":[{"type":"text","text":"A "},{"identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/StatusBar","type":"reference","isActive":true},{"type":"text","text":" view is created with resolved palette colors"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"A dedicated "},{"type":"codeVoice","code":"RenderContext"},{"type":"text","text":" is created with "},{"type":"codeVoice","code":"availableHeight"},{"type":"text","text":" set to the status bar’s height"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"code":"renderToBuffer()","type":"codeVoice"},{"text":" runs on the status bar view: same dispatch as the main content","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"codeVoice","code":"FrameDiffWriter.writeStatusBarDiff()"},{"type":"text","text":" diffs the status bar independently from the main content"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"text","text":"Changed lines are written into the same frame buffer as the content"}],"type":"paragraph"}]}]},{"inlineContent":[{"type":"text","text":"The status bar is "},{"type":"strong","inlineContent":[{"type":"text","text":"never affected"}]},{"type":"text","text":" by view dimming or overlays. It always renders at the bottom of the terminal."}],"type":"paragraph"},{"text":"The Dual Rendering System","anchor":"The-Dual-Rendering-System","type":"heading","level":2},{"inlineContent":[{"type":"text","text":"TUIkit has two ways for a view to produce output:"}],"type":"paragraph"},{"text":"Path 1: Direct Rendering (Renderable)","anchor":"Path-1-Direct-Rendering-Renderable","type":"heading","level":3},{"inlineContent":[{"type":"text","text":"Views that conform to "},{"type":"codeVoice","code":"Renderable"},{"type":"text","text":" implement "},{"type":"codeVoice","code":"renderToBuffer(context:)"},{"type":"text","text":" and produce a "},{"type":"codeVoice","code":"FrameBuffer"},{"type":"text","text":" directly. Their "},{"type":"codeVoice","code":"body"},{"type":"text","text":" property is "},{"inlineContent":[{"text":"never called","type":"text"}],"type":"strong"},{"type":"text","text":"."}],"type":"paragraph"},{"inlineContent":[{"text":"This path is used by:","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"inlineContent":[{"type":"text","text":"Leaf views"}],"type":"strong"},{"type":"text","text":": "},{"identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/Text","type":"reference","isActive":true},{"type":"text","text":", "},{"identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/Spacer","type":"reference","isActive":true},{"type":"text","text":", "},{"type":"codeVoice","code":"Divider"},{"type":"text","text":", "},{"type":"codeVoice","code":"EmptyView"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Layout containers"}]},{"type":"text","text":": "},{"code":"VStack","type":"codeVoice"},{"type":"text","text":", "},{"code":"HStack","type":"codeVoice"},{"type":"text","text":", "},{"code":"ZStack","type":"codeVoice"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"inlineContent":[{"type":"text","text":"Interactive views"}],"type":"strong"},{"text":": ","type":"text"},{"identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/Button","type":"reference","isActive":true},{"text":", ","type":"text"},{"identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/ButtonRow","type":"reference","isActive":true},{"text":", ","type":"text"},{"identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/Menu","type":"reference","isActive":true}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Container views"}]},{"type":"text","text":": "},{"type":"reference","isActive":true,"identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/Panel"},{"type":"text","text":", "},{"type":"reference","isActive":true,"identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/Card"},{"type":"text","text":", "},{"type":"reference","isActive":true,"identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/Alert"},{"type":"text","text":", "},{"type":"reference","isActive":true,"identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/Dialog"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Modifier wrappers"}]},{"text":": ","type":"text"},{"type":"codeVoice","code":"ModifiedView"},{"text":", ","type":"text"},{"type":"codeVoice","code":"DimmedModifier"},{"text":", ","type":"text"},{"type":"codeVoice","code":"OverlayModifier"},{"text":", ","type":"text"},{"type":"codeVoice","code":"EnvironmentModifier"},{"text":", ","type":"text"},{"type":"codeVoice","code":"EquatableView"},{"text":", and all lifecycle modifiers","type":"text"}]}]}],"type":"unorderedList"},{"text":"Path 2: Composition (body)","anchor":"Path-2-Composition-body","type":"heading","level":3},{"inlineContent":[{"text":"Views that are ","type":"text"},{"inlineContent":[{"text":"not","type":"text"}],"type":"strong"},{"text":" ","type":"text"},{"code":"Renderable","type":"codeVoice"},{"text":" declare their content through ","type":"text"},{"code":"body","type":"codeVoice"},{"text":". The rendering system recursively renders the body until it hits a ","type":"text"},{"code":"Renderable","type":"codeVoice"},{"text":" leaf.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"This path is used by:"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Composite views"}]},{"type":"text","text":": "},{"identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/Card","type":"reference","isActive":true},{"type":"text","text":" returns "},{"type":"codeVoice","code":"content.padding().border(...)"},{"type":"text","text":", which wraps in a "},{"type":"codeVoice","code":"ContainerView"},{"type":"text","text":" (whose "},{"type":"codeVoice","code":"_ContainerViewCore"},{"type":"text","text":" is "},{"type":"codeVoice","code":"Renderable"},{"type":"text","text":")"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"User-defined views"}]},{"type":"text","text":": Your custom views compose other views in "},{"type":"codeVoice","code":"body"}],"type":"paragraph"}]}],"type":"unorderedList"},{"text":"The Dispatch Function","anchor":"The-Dispatch-Function","type":"heading","level":3},{"inlineContent":[{"type":"text","text":"The free function "},{"type":"codeVoice","code":"renderToBuffer()"},{"type":"text","text":" is the single entry point for all view rendering:"}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["func renderToBuffer<V: View>(_ view: V, context: RenderContext) -> FrameBuffer {","    \/\/ Priority 1: Direct rendering","    if let renderable = view as? Renderable {","        return renderable.renderToBuffer(context: context)","    }","","    \/\/ Priority 2: Composite: set up hydration context and recurse into body.","    \/\/ @State.init self-hydrates from StateStorage during body evaluation.","    if V.Body.self != Never.self {","        let childContext = context.withChildIdentity(type: V.Body.self)","        \/\/ ... activate StateRegistration.activeContext ...","        let body = view.body","        \/\/ ... restore previous context, mark identity active ...","        return renderToBuffer(body, context: childContext)","    }","","    \/\/ Priority 3: No rendering path: empty buffer","    return FrameBuffer()","}"]},{"inlineContent":[{"type":"image","identifier":"render-cycle-dispatch.png"}],"type":"paragraph"},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"If a view conforms to "},{"code":"Renderable","type":"codeVoice"},{"type":"text","text":", its "},{"code":"body","type":"codeVoice"},{"type":"text","text":" is never evaluated. This is intentional: "},{"code":"Renderable","type":"codeVoice"},{"type":"text","text":" views produce output directly and don’t need compositional decomposition."}]}],"style":"important","type":"aside","name":"Important"},{"text":"FrameBuffer","anchor":"FrameBuffer","type":"heading","level":2},{"inlineContent":[{"code":"FrameBuffer","type":"codeVoice"},{"text":" is the off-screen rendering primitive. It holds an array of strings (which may contain ANSI escape codes) representing terminal lines.","type":"text"}],"type":"paragraph"},{"text":"Creation","anchor":"Creation","type":"heading","level":3},{"inlineContent":[{"text":"Views create buffers in their ","type":"text"},{"code":"renderToBuffer(context:)","type":"codeVoice"},{"text":":","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/Text","type":"reference","isActive":true},{"type":"text","text":": single line with ANSI style codes"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"isActive":true,"type":"reference","identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/Spacer"},{"text":": empty lines","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"code":"EmptyView","type":"codeVoice"},{"type":"text","text":": empty buffer (no lines)"}],"type":"paragraph"}]}],"type":"unorderedList"},{"text":"Combination","anchor":"Combination","type":"heading","level":3},{"inlineContent":[{"type":"text","text":"Layout containers combine child buffers using "},{"code":"FrameBuffer","type":"codeVoice"},{"type":"text","text":" methods:"}],"type":"paragraph"},{"rows":[[[{"inlineContent":[{"type":"text","text":"Method"}],"type":"paragraph"}],[{"inlineContent":[{"text":"Used by","type":"text"}],"type":"paragraph"}],[{"inlineContent":[{"text":"What it does","type":"text"}],"type":"paragraph"}]],[[{"inlineContent":[{"code":"appendVertically(_:spacing:)","type":"codeVoice"}],"type":"paragraph"}],[{"inlineContent":[{"code":"VStack","type":"codeVoice"}],"type":"paragraph"}],[{"inlineContent":[{"text":"Stacks buffers top to bottom","type":"text"}],"type":"paragraph"}]],[[{"inlineContent":[{"code":"appendHorizontally(_:spacing:)","type":"codeVoice"}],"type":"paragraph"}],[{"inlineContent":[{"code":"HStack","type":"codeVoice"}],"type":"paragraph"}],[{"inlineContent":[{"type":"text","text":"Places buffers side by side, padding shorter sides"}],"type":"paragraph"}]],[[{"inlineContent":[{"type":"codeVoice","code":"overlay(_:)"}],"type":"paragraph"}],[{"inlineContent":[{"code":"ZStack","type":"codeVoice"}],"type":"paragraph"}],[{"inlineContent":[{"text":"Line-by-line overlay, non-empty lines replace base","type":"text"}],"type":"paragraph"}]],[[{"inlineContent":[{"type":"codeVoice","code":"composited(with:at:)"}],"type":"paragraph"}],[{"inlineContent":[{"type":"text","text":"Overlay modifier"}],"type":"paragraph"}],[{"inlineContent":[{"type":"text","text":"Character-level compositing at (x, y) position"}],"type":"paragraph"}]]],"type":"table","header":"row"},{"text":"Diff-Based Output","anchor":"Diff-Based-Output","type":"heading","level":3},{"inlineContent":[{"text":"After the view tree produces a ","type":"text"},{"code":"FrameBuffer","type":"codeVoice"},{"text":", the ","type":"text"},{"code":"FrameDiffWriter","type":"codeVoice"},{"text":" prepares terminal-ready output:","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"text":"Lines with content get their ANSI reset codes replaced with ","type":"text"},{"code":"reset + backgroundColor","type":"codeVoice"},{"text":" (persistent background)","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Each line is padded to full terminal width","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Empty lines are filled with the background color"}]}]}],"type":"orderedList"},{"inlineContent":[{"type":"text","text":"The diff writer then compares each output line with the previous frame. Only lines that actually changed are written to the terminal via "},{"code":"Terminal.moveCursor()","type":"codeVoice"},{"type":"text","text":" + "},{"code":"Terminal.write()","type":"codeVoice"},{"type":"text","text":". All writes are collected in a frame buffer and flushed as a single syscall."}],"type":"paragraph"},{"text":"Environment Flow","anchor":"Environment-Flow","type":"heading","level":2},{"inlineContent":[{"type":"text","text":"Environment values flow "},{"inlineContent":[{"text":"top-down","type":"text"}],"type":"strong"},{"type":"text","text":" through the render tree via "},{"type":"codeVoice","code":"RenderContext"},{"type":"text","text":":"}],"type":"paragraph"},{"syntax":null,"type":"codeListing","code":["RenderLoop.buildEnvironment()","  → RenderContext carries EnvironmentValues","    → EnvironmentModifier creates a copy with modified value","      → Children see the modified value","    → Siblings and parents see the original (copy semantics)"]},{"inlineContent":[{"type":"text","text":"The "},{"type":"codeVoice","code":"EnvironmentModifier"},{"type":"text","text":" (created by "},{"type":"codeVoice","code":".environment(_:_:)"},{"type":"text","text":") works by:"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"text":"Creating a new ","type":"text"},{"code":"EnvironmentValues","type":"codeVoice"},{"text":" with the modified key","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Creating a new ","type":"text"},{"type":"codeVoice","code":"RenderContext"},{"text":" with that environment via ","type":"text"},{"type":"codeVoice","code":"context.withEnvironment()"}]}]},{"content":[{"inlineContent":[{"text":"Rendering its content with the new context","type":"text"}],"type":"paragraph"}]}],"type":"orderedList"},{"inlineContent":[{"type":"text","text":"There is no global environment: everything flows through the context parameter."}],"type":"paragraph"},{"text":"Preference Collection","anchor":"Preference-Collection","type":"heading","level":2},{"inlineContent":[{"text":"Preferences flow ","type":"text"},{"type":"strong","inlineContent":[{"text":"bottom-up","type":"text"}]},{"text":": the reverse of environment values. Child views set values that parent views observe.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"codeVoice","code":"PreferenceStorage"},{"text":" uses a stack-based collection mechanism:","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"code":"OnPreferenceChangeModifier","type":"codeVoice"},{"text":" calls ","type":"text"},{"code":"push()","type":"codeVoice"},{"text":": creates a new collection scope","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Its child tree renders, and "},{"type":"codeVoice","code":"PreferenceModifier"},{"type":"text","text":" calls "},{"type":"codeVoice","code":"setValue()"},{"type":"text","text":" on the current scope"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"OnPreferenceChangeModifier"},{"type":"text","text":" calls "},{"type":"codeVoice","code":"pop()"},{"type":"text","text":": merges collected values into the parent scope and fires the callback"}]}]}],"type":"orderedList"},{"inlineContent":[{"text":"The ","type":"text"},{"code":"reduce(value:nextValue:)","type":"codeVoice"},{"text":" function on ","type":"text"},{"code":"PreferenceKey","type":"codeVoice"},{"text":" controls how multiple values from different children are combined. The default behavior: last value wins.","type":"text"}],"type":"paragraph"},{"text":"ViewModifier Pipeline","anchor":"ViewModifier-Pipeline","type":"heading","level":2},{"inlineContent":[{"type":"text","text":"TUIkit has two modifier architectures:"}],"type":"paragraph"},{"text":"Buffer Modifiers (ViewModifier protocol)","anchor":"Buffer-Modifiers-ViewModifier-protocol","type":"heading","level":3},{"inlineContent":[{"text":"These transform a ","type":"text"},{"type":"codeVoice","code":"FrameBuffer"},{"text":" after the content has rendered:","type":"text"}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["public protocol ViewModifier {","    func modify(buffer: FrameBuffer, context: RenderContext) -> FrameBuffer","    func adjustContext(_ context: RenderContext) -> RenderContext  \/\/ default: returns context unchanged","}"]},{"inlineContent":[{"code":"ModifiedView","type":"codeVoice"},{"text":" wraps a view and a modifier. It first calls ","type":"text"},{"code":"adjustContext(_:)","type":"codeVoice"},{"text":" to let the modifier reduce available space (e.g. padding), then renders the content, then calls ","type":"text"},{"code":"modify(buffer:context:)","type":"codeVoice"},{"text":". Examples:","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"code":"PaddingModifier","type":"codeVoice"}]},{"type":"text","text":": Adds empty lines (top\/bottom) and spaces (leading\/trailing) around the buffer"}]}]},{"content":[{"inlineContent":[{"type":"strong","inlineContent":[{"type":"codeVoice","code":"BackgroundModifier"}]},{"type":"text","text":": Wraps each line with background ANSI codes, padded to full width"}],"type":"paragraph"}]}],"type":"unorderedList"},{"text":"View-Level Modifiers (Renderable)","anchor":"View-Level-Modifiers-Renderable","type":"heading","level":3},{"inlineContent":[{"type":"text","text":"More complex modifiers are full "},{"type":"codeVoice","code":"View + Renderable"},{"type":"text","text":" implementations that control when and how their content renders:"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"type":"strong","inlineContent":[{"type":"codeVoice","code":"ContainerView"},{"type":"text","text":" \/ "},{"type":"codeVoice","code":"_ContainerViewCore"}]},{"type":"text","text":": Reduces "},{"type":"codeVoice","code":"availableWidth"},{"type":"text","text":" by 2, renders content, adds border characters via "},{"type":"codeVoice","code":"BorderRenderer"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"inlineContent":[{"type":"codeVoice","code":"FlexibleFrameView"}],"type":"strong"},{"type":"text","text":": Modifies "},{"type":"codeVoice","code":"availableWidth"},{"type":"text","text":"\/"},{"type":"codeVoice","code":"availableHeight"},{"type":"text","text":" before rendering, applies min\/max constraints and alignment after"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"code":"OverlayModifier","type":"codeVoice"}]},{"text":": Renders base and overlay separately, composites via ","type":"text"},{"type":"codeVoice","code":"FrameBuffer.composited(with:at:)"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"inlineContent":[{"code":"DimmedModifier","type":"codeVoice"}],"type":"strong"},{"type":"text","text":": Renders content, then applies ANSI dim code to every line"}]}]},{"content":[{"inlineContent":[{"type":"strong","inlineContent":[{"code":"EnvironmentModifier","type":"codeVoice"}]},{"type":"text","text":": Creates modified context, renders content with it"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"strong","inlineContent":[{"code":"EquatableView","type":"codeVoice"}]},{"type":"text","text":": Checks "},{"type":"codeVoice","code":"RenderCache"},{"type":"text","text":" before rendering; returns cached buffer on hit, renders and stores on miss (see "},{"type":"reference","identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/RenderCycle#Subtree-Memoization","isActive":true},{"type":"text","text":")"}]}]}],"type":"unorderedList"},{"text":"Lifecycle Tracking","anchor":"Lifecycle-Tracking","type":"heading","level":2},{"inlineContent":[{"text":"The ","type":"text"},{"code":"LifecycleManager","type":"codeVoice"},{"text":" tracks view visibility across frames using unique tokens (UUIDs):","type":"text"}],"type":"paragraph"},{"text":"onAppear","anchor":"onAppear","type":"heading","level":3},{"inlineContent":[{"type":"text","text":"The "},{"type":"codeVoice","code":"OnAppearModifier"},{"type":"text","text":" calls "},{"type":"codeVoice","code":"lifecycle.recordAppear(token, action)"},{"type":"text","text":" during rendering:"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"The token is added to ","type":"text"},{"code":"currentRenderTokens","type":"codeVoice"},{"text":" (always)","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"If the token has "},{"type":"strong","inlineContent":[{"text":"never appeared before","type":"text"}]},{"type":"text","text":": it’s added to "},{"type":"codeVoice","code":"appearedTokens"},{"type":"text","text":" and the action fires"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"If it ","type":"text"},{"inlineContent":[{"type":"text","text":"has"}],"type":"strong"},{"text":" appeared before: the action does ","type":"text"},{"inlineContent":[{"type":"text","text":"not"}],"type":"strong"},{"text":" fire (prevents repeated triggers)","type":"text"}],"type":"paragraph"}]}],"type":"unorderedList"},{"content":[{"inlineContent":[{"text":"","type":"text"},{"type":"codeVoice","code":"onAppear"},{"text":" fires ","type":"text"},{"inlineContent":[{"type":"text","text":"synchronously"}],"type":"strong"},{"text":" during the render traversal: not after the frame completes. This is because TUIkit uses single-pass rendering with no layout phase.","type":"text"}],"type":"paragraph"}],"style":"note","type":"aside","name":"Note"},{"text":"onDisappear","anchor":"onDisappear","type":"heading","level":3},{"inlineContent":[{"text":"The ","type":"text"},{"code":"OnDisappearModifier","type":"codeVoice"},{"text":" does two things during rendering:","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"text":"Registers its callback with ","type":"text"},{"code":"lifecycle.registerDisappear(token, action)","type":"codeVoice"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Marks itself as visible with ","type":"text"},{"type":"codeVoice","code":"lifecycle.recordAppear(token, {})"},{"text":" (empty action)","type":"text"}],"type":"paragraph"}]}],"type":"orderedList"},{"inlineContent":[{"text":"The actual ","type":"text"},{"code":"onDisappear","type":"codeVoice"},{"text":" callback fires in step 7 (end lifecycle tracking), ","type":"text"},{"inlineContent":[{"text":"after","type":"text"}],"type":"strong"},{"text":" the entire view tree has rendered.","type":"text"}],"type":"paragraph"},{"text":"Task Lifecycle","anchor":"Task-Lifecycle","type":"heading","level":3},{"inlineContent":[{"type":"text","text":"The "},{"type":"codeVoice","code":"TaskModifier"},{"type":"text","text":" (created by "},{"type":"codeVoice","code":".task()"},{"type":"text","text":") combines appearance tracking with async tasks:"}],"type":"paragraph"},{"items":[{"content":[{"inlineContent":[{"type":"text","text":"On first appearance: starts a "},{"code":"Task","type":"codeVoice"},{"type":"text","text":" with the given priority and operation"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"Registers a disappear callback that cancels the task","type":"text"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"If the view reappears, a new task starts","type":"text"}]}]}],"type":"orderedList"},{"text":"Output Optimization","anchor":"Output-Optimization","type":"heading","level":2},{"inlineContent":[{"type":"text","text":"TUIkit uses three techniques to minimize terminal I\/O:"}],"type":"paragraph"},{"text":"Line-Level Diffing","anchor":"Line-Level-Diffing","type":"heading","level":3},{"inlineContent":[{"code":"FrameDiffWriter","type":"codeVoice"},{"type":"text","text":" stores the previous frame’s output lines and compares them with the new frame. Only lines that actually changed are written to the terminal. For mostly-static UIs (where only a few elements change per frame), this reduces terminal writes by ~94%."}],"type":"paragraph"},{"text":"Frame Buffering","anchor":"Frame-Buffering","type":"heading","level":3},{"inlineContent":[{"text":"All terminal writes during a frame are collected in an internal ","type":"text"},{"type":"codeVoice","code":"[UInt8]"},{"text":" buffer via ","type":"text"},{"type":"codeVoice","code":"Terminal.beginFrame()"},{"text":" \/ ","type":"text"},{"type":"codeVoice","code":"Terminal.endFrame()"},{"text":". The entire frame is flushed to ","type":"text"},{"type":"codeVoice","code":"STDOUT_FILENO"},{"text":" in a ","type":"text"},{"type":"strong","inlineContent":[{"type":"text","text":"single "},{"type":"codeVoice","code":"write()"},{"type":"text","text":" syscall"}]},{"text":", reducing per-frame syscalls from ~40+ to exactly 1.","type":"text"}],"type":"paragraph"},{"text":"Width Caching","anchor":"Width-Caching","type":"heading","level":3},{"inlineContent":[{"type":"codeVoice","code":"FrameBuffer"},{"text":" caches its ","type":"text"},{"type":"codeVoice","code":"width"},{"text":" as a stored property, recomputed only when ","type":"text"},{"type":"codeVoice","code":"lines"},{"text":" is mutated. This eliminates hundreds of redundant ANSI-stripping regex runs per frame. The ","type":"text"},{"type":"codeVoice","code":"strippedLength"},{"text":" property also avoids intermediate string allocations.","type":"text"}],"type":"paragraph"},{"text":"What Is NOT Diffed","anchor":"What-Is-NOT-Diffed","type":"heading","level":3},{"inlineContent":[{"text":"The view tree is re-evaluated each frame: there is no virtual DOM. However, views wrapped in ","type":"text"},{"code":"EquatableView","type":"codeVoice"},{"text":" (via ","type":"text"},{"code":".equatable()","type":"codeVoice"},{"text":") can skip subtree rendering when their properties are unchanged. See ","type":"text"},{"isActive":true,"type":"reference","identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/RenderCycle#Subtree-Memoization"},{"text":" below.","type":"text"}],"type":"paragraph"},{"inlineContent":[{"text":"The alternate screen buffer (entered during setup) ensures that the user’s previous terminal content is preserved and restored on exit.","type":"text"}],"type":"paragraph"},{"text":"Subtree Memoization","anchor":"Subtree-Memoization","type":"heading","level":2},{"inlineContent":[{"text":"While the view tree is reconstructed each frame, ","type":"text"},{"type":"codeVoice","code":"EquatableView"},{"text":" allows ","type":"text"},{"type":"strong","inlineContent":[{"text":"individual subtrees","type":"text"}]},{"text":" to skip rendering when their inputs haven’t changed. This combines the simplicity of full tree evaluation with targeted caching for expensive or static subtrees.","type":"text"}],"type":"paragraph"},{"text":"How It Works","anchor":"How-It-Works","type":"heading","level":3},{"inlineContent":[{"type":"text","text":"When a view is wrapped in "},{"type":"codeVoice","code":".equatable()"},{"type":"text","text":", the rendering system:"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Looks up the cached "},{"type":"codeVoice","code":"FrameBuffer"},{"type":"text","text":" for this view’s "},{"type":"codeVoice","code":"ViewIdentity"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Compares the "},{"inlineContent":[{"text":"current view value","type":"text"}],"type":"strong"},{"type":"text","text":" with the cached snapshot via "},{"type":"codeVoice","code":"Equatable.=="}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Checks that the available ","type":"text"},{"inlineContent":[{"type":"text","text":"width and height"}],"type":"strong"},{"text":" haven’t changed","type":"text"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"On "},{"inlineContent":[{"type":"text","text":"cache hit"}],"type":"strong"},{"type":"text","text":": returns the cached buffer: the entire subtree is skipped"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"text":"On ","type":"text"},{"type":"strong","inlineContent":[{"type":"text","text":"cache miss"}]},{"text":": renders normally and stores the result","type":"text"}],"type":"paragraph"}]}],"type":"orderedList"},{"syntax":"swift","type":"codeListing","code":["\/\/ A static info box: title and subtitle are the only inputs.","struct FeatureBox: View, Equatable {","    let title: String","    let subtitle: String","","    var body: some View {","        VStack {","            Text(title).bold().foregroundColor(.palette.accent)","            Text(subtitle).foregroundColor(.palette.foregroundSecondary)","        }","        .padding(EdgeInsets(horizontal: 2, vertical: 1))","        .border(color: .palette.border)","    }","}","","\/\/ In a parent view: cached between frames when title\/subtitle are unchanged:","FeatureBox(\"Pure Swift\", \"No ncurses\").equatable()"]},{"text":"Cache Invalidation","anchor":"Cache-Invalidation","type":"heading","level":3},{"inlineContent":[{"text":"The ","type":"text"},{"code":"RenderCache","type":"codeVoice"},{"text":" is ","type":"text"},{"type":"strong","inlineContent":[{"type":"text","text":"fully cleared"}]},{"text":" in two situations:","type":"text"}],"type":"paragraph"},{"rows":[[[{"inlineContent":[{"type":"text","text":"Trigger"}],"type":"paragraph"}],[{"inlineContent":[{"text":"Mechanism","type":"text"}],"type":"paragraph"}]],[[{"inlineContent":[{"type":"text","text":"Any "},{"type":"codeVoice","code":"@State"},{"type":"text","text":" change"}],"type":"paragraph"}],[{"inlineContent":[{"type":"codeVoice","code":"StateBox.value.didSet"},{"type":"text","text":" calls "},{"type":"codeVoice","code":"renderCache.clearAll()"}],"type":"paragraph"}]],[[{"inlineContent":[{"text":"Environment change","type":"text"}],"type":"paragraph"}],[{"inlineContent":[{"type":"codeVoice","code":"RenderLoop"},{"text":" compares an ","type":"text"},{"type":"codeVoice","code":"EnvironmentSnapshot"},{"text":" (palette ID + appearance ID) each frame and clears on mismatch","type":"text"}],"type":"paragraph"}]]],"type":"table","header":"row"},{"inlineContent":[{"text":"Between these events: for example during Spinner animation frames at 25 FPS: the cache is fully active. Static subtrees are rendered once and reused for every subsequent frame.","type":"text"}],"type":"paragraph"},{"text":"When to Use `.equatable()`","anchor":"When-to-Use-equatable","type":"heading","level":3},{"rows":[[[{"inlineContent":[{"type":"text","text":"Good candidates"}],"type":"paragraph"}],[{"inlineContent":[{"text":"Why","type":"text"}],"type":"paragraph"}]],[[{"inlineContent":[{"type":"text","text":"Static display views (labels, headers, feature boxes)"}],"type":"paragraph"}],[{"inlineContent":[{"text":"Properties rarely change, body is rebuilt identically each frame","type":"text"}],"type":"paragraph"}]],[[{"inlineContent":[{"type":"text","text":"Complex container hierarchies"}],"type":"paragraph"}],[{"inlineContent":[{"type":"text","text":"Many nested views that produce the same output"}],"type":"paragraph"}]],[[{"inlineContent":[{"type":"text","text":"Views next to animated siblings"}],"type":"paragraph"}],[{"inlineContent":[{"text":"Spinner\/Pulse re-renders the whole tree; static siblings benefit from caching","type":"text"}],"type":"paragraph"}]]],"type":"table","header":"row"},{"rows":[[[{"type":"paragraph","inlineContent":[{"type":"text","text":"Bad candidates"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"Why"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"text","text":"Views that read "},{"type":"codeVoice","code":"@State"},{"type":"text","text":" directly"}]}],[{"type":"paragraph","inlineContent":[{"text":"State lives in a reference-type box: the view struct compares as equal even when state changed","type":"text"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"text","text":"Views that change every frame"}]}],[{"type":"paragraph","inlineContent":[{"text":"Cache overhead with no benefit","type":"text"}]}]],[[{"type":"paragraph","inlineContent":[{"text":"Tiny views (single ","type":"text"},{"code":"Text","type":"codeVoice"},{"text":")","type":"text"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"Rendering cost is already minimal"}]}]]],"type":"table","header":"row"},{"text":"Which Types Support `.equatable()`","anchor":"Which-Types-Support-equatable","type":"heading","level":3},{"inlineContent":[{"text":"The following types have ","type":"text"},{"type":"codeVoice","code":"Equatable"},{"text":" conformance, enabling ","type":"text"},{"type":"codeVoice","code":".equatable()"},{"text":" on views composed of them:","type":"text"}],"type":"paragraph"},{"inlineContent":[{"type":"strong","inlineContent":[{"text":"Leaf views:","type":"text"}]},{"type":"text","text":" "},{"type":"reference","isActive":true,"identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/Text"}],"type":"paragraph"},{"inlineContent":[{"inlineContent":[{"text":"Container views","type":"text"}],"type":"strong"},{"type":"text","text":" (conditional: "},{"type":"codeVoice","code":"where Content: Equatable"},{"type":"text","text":"): "},{"type":"codeVoice","code":"VStack"},{"type":"text","text":", "},{"type":"codeVoice","code":"HStack"},{"type":"text","text":", "},{"type":"codeVoice","code":"ZStack"},{"type":"text","text":", "},{"isActive":true,"type":"reference","identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/Panel"},{"type":"text","text":", "},{"isActive":true,"type":"reference","identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/Card"},{"type":"text","text":", "},{"isActive":true,"type":"reference","identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/Dialog"},{"type":"text","text":", "},{"type":"codeVoice","code":"ContainerView"}],"type":"paragraph"},{"inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"Modifier views"}]},{"type":"text","text":" (conditional): "},{"type":"codeVoice","code":"FlexibleFrameView"},{"type":"text","text":", "},{"type":"codeVoice","code":"OverlayModifier"},{"type":"text","text":", "},{"type":"codeVoice","code":"DimmedModifier"}],"type":"paragraph"},{"inlineContent":[{"inlineContent":[{"text":"Supporting types:","type":"text"}],"type":"strong"},{"text":" ","type":"text"},{"code":"TextStyle","type":"codeVoice"},{"text":", ","type":"text"},{"code":"Alignment","type":"codeVoice"},{"text":", ","type":"text"},{"code":"ContainerConfig","type":"codeVoice"},{"text":", ","type":"text"},{"code":"ContainerStyle","type":"codeVoice"}],"type":"paragraph"},{"content":[{"inlineContent":[{"type":"text","text":""},{"type":"codeVoice","code":"Button"},{"type":"text","text":" cannot be "},{"type":"codeVoice","code":"Equatable"},{"type":"text","text":" because it stores a closure ("},{"type":"codeVoice","code":"action: () -> Void"},{"type":"text","text":"). Views containing buttons are not candidates for "},{"type":"codeVoice","code":".equatable()"},{"type":"text","text":"."}],"type":"paragraph"}],"style":"note","type":"aside","name":"Note"},{"text":"Debug Logging","anchor":"Debug-Logging","type":"heading","level":3},{"inlineContent":[{"text":"Set ","type":"text"},{"code":"TUIKIT_DEBUG_RENDER=1","type":"codeVoice"},{"text":" to enable per-frame cache statistics on stderr:","type":"text"}],"type":"paragraph"},{"syntax":null,"type":"codeListing","code":["[RenderCache] STORE Root\/MainMenuPage\/FeatureBox","[RenderCache] HIT Root\/MainMenuPage\/FeatureBox","[RenderCache] MISS (no entry) Root\/SpinnersPage\/Spinner","[RenderCache] FRAME: hits: 3, misses: 2, stores: 2, clears: 0, entries: 3, hit rate: 60%"]},{"inlineContent":[{"type":"text","text":"Redirect with "},{"code":"2>render.log","type":"codeVoice"},{"type":"text","text":" to capture without interfering with the TUI."}],"type":"paragraph"}]}],"schemaVersion":{"patch":0,"major":0,"minor":3},"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/tuikit\/rendercycle"]}],"references":{"doc://TUIkit/documentation/TUIkit":{"images":[{"type":"icon","identifier":"tuikit-logo.png"},{"type":"card","identifier":"tuikit-logo.png"}],"kind":"symbol","url":"\/documentation\/tuikit","identifier":"doc:\/\/TUIkit\/documentation\/TUIkit","type":"topic","abstract":[{"type":"text","text":"A declarative, SwiftUI-like framework for building Terminal User Interfaces in Swift."}],"title":"TUIkit","role":"collection"},"doc://TUIkit/documentation/TUIkit/GettingStarted":{"type":"topic","title":"Getting Started","url":"\/documentation\/tuikit\/gettingstarted","identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/GettingStarted","kind":"article","abstract":[{"text":"Build your first terminal application with TUIkit.","type":"text"}],"role":"article"},"doc://TUIkit/documentation/TUIkit/Button":{"kind":"symbol","navigatorTitle":[{"kind":"identifier","text":"Button"}],"url":"\/documentation\/tuikit\/button","role":"symbol","identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/Button","type":"topic","fragments":[{"kind":"keyword","text":"struct"},{"kind":"text","text":" "},{"kind":"identifier","text":"Button"}],"abstract":[{"type":"text","text":"An interactive button that triggers an action when pressed."}],"title":"Button"},"doc://TUIkit/documentation/TUIkit/AppLifecycle":{"url":"\/documentation\/tuikit\/applifecycle","role":"article","title":"App Lifecycle","abstract":[{"text":"Understand how a TUIkit application starts, runs, and shuts down.","type":"text"}],"identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/AppLifecycle","kind":"article","type":"topic"},"doc://TUIkit/documentation/TUIkit/Spacer":{"fragments":[{"kind":"keyword","text":"struct"},{"kind":"text","text":" "},{"kind":"identifier","text":"Spacer"}],"identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/Spacer","title":"Spacer","kind":"symbol","url":"\/documentation\/tuikit\/spacer","type":"topic","role":"symbol","navigatorTitle":[{"kind":"identifier","text":"Spacer"}],"abstract":[{"type":"text","text":"A flexible spacer that fills available space."}]},"tuikit-logo.png":{"identifier":"tuikit-logo.png","variants":[{"url":"\/images\/TUIkit\/tuikit-logo.png","traits":["1x","light"]}],"alt":"TUIkit Logo","type":"image"},"doc://TUIkit/documentation/TUIkit/StatusBar":{"abstract":[{"type":"text","text":"A status bar that displays at the bottom of the terminal."}],"navigatorTitle":[{"kind":"identifier","text":"StatusBar"}],"title":"StatusBar","url":"\/documentation\/tuikit\/statusbar","type":"topic","fragments":[{"kind":"keyword","text":"struct"},{"kind":"text","text":" "},{"kind":"identifier","text":"StatusBar"}],"identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/StatusBar","role":"symbol","kind":"symbol"},"doc://TUIkit/documentation/TUIkit/RenderCycle#Subtree-Memoization":{"abstract":[],"url":"\/documentation\/tuikit\/rendercycle#Subtree-Memoization","identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/RenderCycle#Subtree-Memoization","type":"topic","title":"Subtree Memoization","kind":"section"},"doc://TUIkit/documentation/TUIkit/ButtonRow":{"kind":"symbol","fragments":[{"kind":"keyword","text":"struct"},{"kind":"text","text":" "},{"kind":"identifier","text":"ButtonRow"}],"identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/ButtonRow","navigatorTitle":[{"kind":"identifier","text":"ButtonRow"}],"role":"symbol","abstract":[{"type":"text","text":"A horizontal row of buttons."}],"title":"ButtonRow","url":"\/documentation\/tuikit\/buttonrow","type":"topic"},"doc://TUIkit/documentation/TUIkit/RenderCycle#The-Dual-Rendering-System":{"identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/RenderCycle#The-Dual-Rendering-System","url":"\/documentation\/tuikit\/rendercycle#The-Dual-Rendering-System","kind":"section","type":"topic","abstract":[],"title":"The Dual Rendering System"},"doc://TUIkit/documentation/TUIkit/Dialog":{"title":"Dialog","identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/Dialog","navigatorTitle":[{"text":"Dialog","kind":"identifier"}],"url":"\/documentation\/tuikit\/dialog","abstract":[{"type":"text","text":"A modal dialog view with a title, customizable content, and optional footer."}],"fragments":[{"text":"struct","kind":"keyword"},{"text":" ","kind":"text"},{"text":"Dialog","kind":"identifier"}],"kind":"symbol","type":"topic","role":"symbol"},"render-cycle-dispatch.png":{"identifier":"render-cycle-dispatch.png","type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/TUIkit\/render-cycle-dispatch.png"},{"traits":["1x","dark"],"url":"\/images\/TUIkit\/render-cycle-dispatch~dark.png"}],"alt":"Decision tree showing the dual rendering dispatch: renderToBuffer checks Renderable conformance first, then body recursion, then returns an empty buffer as fallback."},"doc://TUIkit/documentation/TUIkit/Menu":{"title":"Menu","role":"symbol","url":"\/documentation\/tuikit\/menu","kind":"symbol","identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/Menu","type":"topic","abstract":[{"text":"A vertical menu displaying a list of selectable items.","type":"text"}],"fragments":[{"kind":"keyword","text":"struct"},{"text":" ","kind":"text"},{"text":"Menu","kind":"identifier"}],"navigatorTitle":[{"text":"Menu","kind":"identifier"}]},"doc://TUIkit/documentation/TUIkit/Text":{"identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/Text","type":"topic","fragments":[{"kind":"keyword","text":"struct"},{"kind":"text","text":" "},{"kind":"identifier","text":"Text"}],"role":"symbol","abstract":[{"type":"text","text":"A view that displays text in the terminal."}],"title":"Text","url":"\/documentation\/tuikit\/text","navigatorTitle":[{"kind":"identifier","text":"Text"}],"kind":"symbol"},"doc://TUIkit/documentation/TUIkit/WindowGroup":{"identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/WindowGroup","fragments":[{"kind":"keyword","text":"struct"},{"kind":"text","text":" "},{"kind":"identifier","text":"WindowGroup"}],"url":"\/documentation\/tuikit\/windowgroup","navigatorTitle":[{"kind":"identifier","text":"WindowGroup"}],"abstract":[{"type":"text","text":"A scene that represents a single window (terminal)."}],"type":"topic","title":"WindowGroup","kind":"symbol","role":"symbol"},"doc://TUIkit/documentation/TUIkit/Alert":{"fragments":[{"kind":"keyword","text":"struct"},{"kind":"text","text":" "},{"kind":"identifier","text":"Alert"}],"navigatorTitle":[{"kind":"identifier","text":"Alert"}],"url":"\/documentation\/tuikit\/alert","abstract":[{"type":"text","text":"A modal alert view that displays a title, message, and optional action buttons."}],"title":"Alert","type":"topic","identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/Alert","kind":"symbol","role":"symbol"},"doc://TUIkit/documentation/TUIkit/Card":{"url":"\/documentation\/tuikit\/card","type":"topic","abstract":[{"text":"A padded, optionally titled container with background support.","type":"text"}],"identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/Card","kind":"symbol","title":"Card","fragments":[{"text":"struct","kind":"keyword"},{"text":" ","kind":"text"},{"text":"Card","kind":"identifier"}],"role":"symbol","navigatorTitle":[{"text":"Card","kind":"identifier"}]},"doc://TUIkit/documentation/TUIkit/Architecture":{"role":"article","type":"topic","kind":"article","abstract":[{"type":"text","text":"Understand the layer model and rendering pipeline of TUIkit."}],"identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/Architecture","title":"Architecture","url":"\/documentation\/tuikit\/architecture"},"doc://TUIkit/documentation/TUIkit/Panel":{"fragments":[{"kind":"keyword","text":"struct"},{"kind":"text","text":" "},{"kind":"identifier","text":"Panel"}],"title":"Panel","abstract":[{"text":"A labeled container — always has a title, optionally a footer.","type":"text"}],"role":"symbol","url":"\/documentation\/tuikit\/panel","kind":"symbol","navigatorTitle":[{"kind":"identifier","text":"Panel"}],"identifier":"doc:\/\/TUIkit\/documentation\/TUIkit\/Panel","type":"topic"},"render-cycle-pipeline.png":{"identifier":"render-cycle-pipeline.png","variants":[{"url":"\/images\/TUIkit\/render-cycle-pipeline.png","traits":["1x","light"]},{"url":"\/images\/TUIkit\/render-cycle-pipeline~dark.png","traits":["1x","dark"]}],"alt":"Diagram showing the 12-step render pipeline: Step 1 clear per-frame state (key handlers, preferences, focus, status bar, app header), Step 2 begin lifecycle\/state\/cache tracking, Step 3 build environment with all subsystem values and services, Step 4 create render context, Step 5 evaluate scene, Step 6 render view tree, Step 7 build output lines, Step 8 begin buffered frame, Step 9 render app header and diff content, Step 10 render status bar, Step 11 flush frame, Step 12 end tracking (lifecycle onDisappear, state GC, cache cleanup).","type":"image"}}}